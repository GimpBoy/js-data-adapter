{"version":3,"file":"js-data-adapter.js","sources":["../src/index.js"],"sourcesContent":["import {utils} from 'js-data'\n\nconst noop = function (...args) {\n  const self = this\n  const opts = args[args.length - 1]\n  self.dbg(opts.op, ...args)\n  return utils.resolve()\n}\n\nconst noop2 = function (...args) {\n  const self = this\n  const opts = args[args.length - 2]\n  self.dbg(opts.op, ...args)\n  return utils.resolve()\n}\n\nconst unique = function (array) {\n  const seen = {}\n  const final = []\n  array.forEach(function (item) {\n    if (item in seen) {\n      return\n    }\n    final.push(item)\n    seen[item] = 0\n  })\n  return final\n}\n\nconst withoutRelations = function (mapper, props) {\n  return utils.omit(props, mapper.relationFields || [])\n}\n\nconst DEFAULTS = {\n  /**\n   * Whether to log debugging information.\n   *\n   * @name Adapter#debug\n   * @type {boolean}\n   * @default false\n   */\n  debug: false,\n\n  /**\n   * Whether to return a more detailed response object.\n   *\n   * @name Adapter#raw\n   * @type {boolean}\n   * @default false\n   */\n  raw: false\n}\n\n/**\n * Abstract class meant to be extended by adapters.\n *\n * @class Adapter\n * @abstract\n * @param {Object} [opts] Configuration opts.\n * @param {boolean} [opts.debug=false] Whether to log debugging information.\n * @param {boolean} [opts.raw=false] Whether to return a more detailed response\n * object.\n */\nfunction Adapter (opts) {\n  const self = this\n  opts || (opts = {})\n  utils.fillIn(opts, DEFAULTS)\n  utils.fillIn(self, opts)\n}\n\nAdapter.reserved = [\n  'orderBy',\n  'sort',\n  'limit',\n  'offset',\n  'skip',\n  'where'\n]\n\n/**\n * Response object used when `raw` is `true`. May contain other fields in\n * addition to `data`.\n *\n * @typedef {Object} Response\n * @property {Object} data Response data.\n * @property {string} op The operation for which the response was created.\n */\nfunction Response (data, meta, op) {\n  const self = this\n  meta || (meta = {})\n  self.data = data\n  utils.fillIn(self, meta)\n  self.op = op\n}\n\nAdapter.Response = Response\n\n/**\n * Alternative to ES6 class syntax for extending `Adapter`.\n *\n * @name Adapter.extend\n * @method\n * @param {Object} [instanceProps] Properties that will be added to the\n * prototype of the subclass.\n * @param {Object} [classProps] Properties that will be added as static\n * properties to the subclass itself.\n * @return {Object} Subclass of `Adapter`.\n */\nAdapter.extend = utils.extend\n\nutils.addHiddenPropsToTarget(Adapter.prototype, {\n  /**\n   * Lifecycle method method called by <a href=\"#count__anchor\">count</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#count__anchor\">count</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the count.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#count__anchor\">count</a>.\n   *\n   * @name Adapter#afterCount\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @property {string} opts.op `afterCount`\n   * @param {Object|Response} response Count or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterCount: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#create__anchor\">create</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#create__anchor\">create</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the created record.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#create__anchor\">create</a>.\n   *\n   * @name Adapter#afterCreate\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @property {string} opts.op `afterCreate`\n   * @param {Object|Response} response Created record or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterCreate: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#createMany__anchor\">createMany</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#createMany__anchor\">createMany</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the created records.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#createMany__anchor\">createMany</a>.\n   *\n   * @name Adapter#afterCreate\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @param {Object[]} props The `props` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @property {string} opts.op `afterCreateMany`\n   * @param {Object[]|Response} response Created records or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterCreateMany: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#destroy__anchor\">destroy</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#destroy__anchor\">destroy</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be `undefined`.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#destroy__anchor\">destroy</a>.\n   *\n   * @name Adapter#afterDestroy\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @property {string} opts.op `afterDestroy`\n   * @param {undefined|Response} response `undefined` or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterDestroy: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#destroyAll__anchor\">destroyAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be `undefined`.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   *\n   * @name Adapter#afterDestroyAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @property {string} opts.op `afterDestroyAll`\n   * @param {undefined|Response} response `undefined` or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterDestroyAll: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#find__anchor\">find</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#find__anchor\">find</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the found record, if any.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#find__anchor\">find</a>.\n   *\n   * @name Adapter#afterFind\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @property {string} opts.op `afterFind`\n   * @param {Object|Response} response The found record or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterFind: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#findAll__anchor\">findAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#findAll__anchor\">findAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the found records, if any.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#findAll__anchor\">findAll</a>.\n   *\n   * @name Adapter#afterFindAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @property {string} opts.op `afterFindAll`\n   * @param {Object[]|Response} response The found records or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterFindAll: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#sum__anchor\">sum</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#sum__anchor\">sum</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the sum.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#sum__anchor\">sum</a>.\n   *\n   * @name Adapter#afterSum\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @property {string} opts.op `afterSum`\n   * @param {Object|Response} response Count or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterSum: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#update__anchor\">update</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#update__anchor\">update</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated record.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#update__anchor\">update</a>.\n   *\n   * @name Adapter#afterUpdate\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @property {string} opts.op `afterUpdate`\n   * @param {Object|Response} response The updated record or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterUpdate: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#updateAll__anchor\">updateAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#updateAll__anchor\">updateAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated records, if any.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#updateAll__anchor\">updateAll</a>.\n   *\n   * @name Adapter#afterUpdateAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @property {string} opts.op `afterUpdateAll`\n   * @param {Object[]|Response} response The updated records or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterUpdateAll: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#updateMany__anchor\">updateMany</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#updateMany__anchor\">updateMany</a> to wait for the Promise to resolve before continuing.\n   *\n   * If `opts.raw` is `true` then `response` will be a detailed response object, otherwise `response` will be the updated records, if any.\n   *\n   * `response` may be modified. You can also re-assign `response` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#updateMany__anchor\">updateMany</a>.\n   *\n   * @name Adapter#afterUpdateMany\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @param {Object[]} records The `records` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @property {string} opts.op `afterUpdateMany`\n   * @param {Object[]|Response} response The updated records or {@link Response}, depending on the value of `opts.raw`.\n   */\n  afterUpdateMany: noop2,\n\n  /**\n   * Lifecycle method method called by <a href=\"#count__anchor\">count</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#count__anchor\">count</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#count__anchor\">count</a>.\n   *\n   * @name Adapter#beforeCount\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#count__anchor\">count</a>.\n   * @property {string} opts.op `beforeCount`\n   */\n  beforeCount: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#create__anchor\">create</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#create__anchor\">create</a> to wait for the Promise to resolve before continuing.\n   *\n   * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#create__anchor\">create</a>.\n   *\n   * @name Adapter#beforeCreate\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#create__anchor\">create</a>.\n   * @property {string} opts.op `beforeCreate`\n   */\n  beforeCreate: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#createMany__anchor\">createMany</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#createMany__anchor\">createMany</a> to wait for the Promise to resolve before continuing.\n   *\n   * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#createMany__anchor\">createMany</a>.\n   *\n   * @name Adapter#beforeCreateMany\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @param {Object[]} props The `props` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#createMany__anchor\">createMany</a>.\n   * @property {string} opts.op `beforeCreateMany`\n   */\n  beforeCreateMany: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#destroy__anchor\">destroy</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#destroy__anchor\">destroy</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#destroy__anchor\">destroy</a>.\n   *\n   * @name Adapter#beforeDestroy\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#destroy__anchor\">destroy</a>.\n   * @property {string} opts.op `beforeDestroy`\n   */\n  beforeDestroy: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#destroyAll__anchor\">destroyAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   *\n   * @name Adapter#beforeDestroyAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#destroyAll__anchor\">destroyAll</a>.\n   * @property {string} opts.op `beforeDestroyAll`\n   */\n  beforeDestroyAll: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#find__anchor\">find</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#find__anchor\">find</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#find__anchor\">find</a>.\n   *\n   * @name Adapter#beforeFind\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#find__anchor\">find</a>.\n   * @property {string} opts.op `beforeFind`\n   */\n  beforeFind: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#findAll__anchor\">findAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#findAll__anchor\">findAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#findAll__anchor\">findAll</a>.\n   *\n   * @name Adapter#beforeFindAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#findAll__anchor\">findAll</a>.\n   * @property {string} opts.op `beforeFindAll`\n   */\n  beforeFindAll: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#sum__anchor\">sum</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#sum__anchor\">sum</a> to wait for the Promise to resolve before continuing.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#sum__anchor\">sum</a>.\n   *\n   * @name Adapter#beforeSum\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#sum__anchor\">sum</a>.\n   * @property {string} opts.op `beforeSum`\n   */\n  beforeSum: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#update__anchor\">update</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#update__anchor\">update</a> to wait for the Promise to resolve before continuing.\n   *\n   * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#update__anchor\">update</a>.\n   *\n   * @name Adapter#beforeUpdate\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {(string|number)} id The `id` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#update__anchor\">update</a>.\n   * @property {string} opts.op `beforeUpdate`\n   */\n  beforeUpdate: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#updateAll__anchor\">updateAll</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#updateAll__anchor\">updateAll</a> to wait for the Promise to resolve before continuing.\n   *\n   * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#updateAll__anchor\">updateAll</a>.\n   *\n   * @name Adapter#beforeUpdateAll\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} props The `props` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} query The `query` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#updateAll__anchor\">updateAll</a>.\n   * @property {string} opts.op `beforeUpdateAll`\n   */\n  beforeUpdateAll: noop,\n\n  /**\n   * Lifecycle method method called by <a href=\"#updateMany__anchor\">updateMany</a>.\n   *\n   * Override this method to add custom behavior for this lifecycle hook.\n   *\n   * Returning a Promise causes <a href=\"#updateMany__anchor\">updateMany</a> to wait for the Promise to resolve before continuing.\n   *\n   * `props` may be modified. You can also re-assign `props` to another value by returning a different value or a Promise that resolves to a different value.\n   *\n   * A thrown error or rejected Promise will bubble up and reject the Promise returned by <a href=\"#updateMany__anchor\">updateMany</a>.\n   *\n   * @name Adapter#beforeUpdateMany\n   * @method\n   * @param {Object} mapper The `mapper` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @param {Object[]} props The `props` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @param {Object} opts The `opts` argument passed to <a href=\"#updateMany__anchor\">updateMany</a>.\n   * @property {string} opts.op `beforeUpdateMany`\n   */\n  beforeUpdateMany: noop,\n\n  /**\n   * Shortcut for `#log('debug'[, arg1[, arg2[, argn]]])`.\n   *\n   * @name Adapter#dbg\n   * @method\n   */\n  dbg (...args) {\n    this.log('debug', ...args)\n  },\n\n  /**\n   * Retrieve the number of records that match the selection query. Called by\n   * `Mapper#count`.\n   *\n   * @name Adapter#count\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  count (mapper, query, opts) {\n    const self = this\n    let op\n    query || (query = {})\n    opts || (opts = {})\n\n    // beforeCount lifecycle hook\n    op = opts.op = 'beforeCount'\n    return utils.resolve(self[op](mapper, query, opts)).then(function () {\n      // Allow for re-assignment from lifecycle hook\n      op = opts.op = 'count'\n      self.dbg(op, mapper, query, opts)\n      return utils.resolve(self._count(mapper, query, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, op)\n      response = self.respond(response, opts)\n\n      // afterCount lifecycle hook\n      op = opts.op = 'afterCount'\n      return utils.resolve(self[op](mapper, query, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Create a new record. Called by `Mapper#create`.\n   *\n   * @name Adapter#create\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The record to be created.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  create (mapper, props, opts) {\n    const self = this\n    let op\n    props || (props = {})\n    opts || (opts = {})\n\n    // beforeCreate lifecycle hook\n    op = opts.op = 'beforeCreate'\n    return utils.resolve(self[op](mapper, props, opts)).then(function (_props) {\n      // Allow for re-assignment from lifecycle hook\n      props = utils.isUndefined(_props) ? props : _props\n      props = withoutRelations(mapper, props)\n      op = opts.op = 'create'\n      self.dbg(op, mapper, props, opts)\n      return utils.resolve(self._create(mapper, props, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, 'create')\n      response.created = data ? 1 : 0\n      response = self.respond(response, opts)\n\n      // afterCreate lifecycle hook\n      op = opts.op = 'afterCreate'\n      return utils.resolve(self[op](mapper, props, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Create multiple records in a single batch. Called by `Mapper#createMany`.\n   *\n   * @name Adapter#createMany\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The records to be created.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  createMany (mapper, props, opts) {\n    const self = this\n    let op\n    props || (props = {})\n    opts || (opts = {})\n\n    // beforeCreateMany lifecycle hook\n    op = opts.op = 'beforeCreateMany'\n    return utils.resolve(self[op](mapper, props, opts)).then(function (_props) {\n      // Allow for re-assignment from lifecycle hook\n      props = utils.isUndefined(_props) ? props : _props\n      props = props.map(function (record) {\n        return withoutRelations(mapper, record)\n      })\n      op = opts.op = 'createMany'\n      self.dbg(op, mapper, props, opts)\n      return utils.resolve(self._createMany(mapper, props, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      data || (data = [])\n      result || (result = {})\n      let response = new Response(data, result, 'createMany')\n      response.created = data.length\n      response = self.respond(response, opts)\n\n      // afterCreateMany lifecycle hook\n      op = opts.op = 'afterCreateMany'\n      return utils.resolve(self[op](mapper, props, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Destroy the record with the given primary key. Called by\n   * `Mapper#destroy`.\n   *\n   * @name Adapter#destroy\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to destroy.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  destroy (mapper, id, opts) {\n    const self = this\n    let op\n    opts || (opts = {})\n\n    // beforeDestroy lifecycle hook\n    op = opts.op = 'beforeDestroy'\n    return utils.resolve(self[op](mapper, id, opts)).then(function () {\n      op = opts.op = 'destroy'\n      self.dbg(op, mapper, id, opts)\n      return utils.resolve(self._destroy(mapper, id, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, 'destroy')\n      response = self.respond(response, opts)\n\n      // afterDestroy lifecycle hook\n      op = opts.op = 'afterDestroy'\n      return utils.resolve(self[op](mapper, id, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Destroy the records that match the selection query. Called by\n   * `Mapper#destroyAll`.\n   *\n   * @name Adapter#destroyAll\n   * @method\n   * @param {Object} mapper the mapper.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  destroyAll (mapper, query, opts) {\n    const self = this\n    let op\n    query || (query = {})\n    opts || (opts = {})\n\n    // beforeDestroyAll lifecycle hook\n    op = opts.op = 'beforeDestroyAll'\n    return utils.resolve(self[op](mapper, query, opts)).then(function () {\n      op = opts.op = 'destroyAll'\n      self.dbg(op, mapper, query, opts)\n      return utils.resolve(self._destroyAll(mapper, query, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, 'destroyAll')\n      response = self.respond(response, opts)\n\n      // afterDestroyAll lifecycle hook\n      op = opts.op = 'afterDestroyAll'\n      return utils.resolve(self[op](mapper, query, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Return the foreignKey from the given record for the provided relationship.\n   *\n   * There may be reasons why you may want to override this method, like when\n   * the id of the parent doesn't exactly match up to the key on the child.\n   *\n   * Override with care.\n   *\n   * @name Adapter#makeHasManyForeignKey\n   * @method\n   * @return {*}\n   */\n  makeHasManyForeignKey (mapper, def, record) {\n    return def.getForeignKey(record)\n  },\n\n  /**\n   * Return the localKeys from the given record for the provided relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#makeHasManyLocalKeys\n   * @method\n   * @return {*}\n   */\n  makeHasManyLocalKeys (mapper, def, record) {\n    let localKeys = []\n    let itemKeys = utils.get(record, def.localKeys) || []\n    itemKeys = utils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n    localKeys = localKeys.concat(itemKeys)\n    return unique(localKeys).filter(function (x) { return x })\n  },\n\n  /**\n   * Return the foreignKeys from the given record for the provided relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#makeHasManyForeignKeys\n   * @method\n   * @return {*}\n   */\n  makeHasManyForeignKeys (mapper, def, record) {\n    return utils.get(record, mapper.idAttribute)\n  },\n\n  /**\n   * Load a hasMany relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#loadHasMany\n   * @method\n   * @return {Promise}\n   */\n  loadHasMany (mapper, def, records, __opts) {\n    const self = this\n    let singular = false\n\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      singular = true\n      records = [records]\n    }\n    const IDs = records.map(function (record) {\n      return self.makeHasManyForeignKey(mapper, def, record)\n    })\n    const query = {\n      where: {}\n    }\n    const criteria = query.where[def.foreignKey] = {}\n    if (singular) {\n      // more efficient query when we only have one record\n      criteria['=='] = IDs[0]\n    } else {\n      criteria['in'] = IDs.filter(function (id) {\n        return id\n      })\n    }\n    return self.findAll(def.getRelation(), query, __opts).then(function (relatedItems) {\n      records.forEach(function (record) {\n        let attached = []\n        // avoid unneccesary iteration when we only have one record\n        if (singular) {\n          attached = relatedItems\n        } else {\n          relatedItems.forEach(function (relatedItem) {\n            if (utils.get(relatedItem, def.foreignKey) === record[mapper.idAttribute]) {\n              attached.push(relatedItem)\n            }\n          })\n        }\n        def.setLocalField(record, attached)\n      })\n    })\n  },\n\n  loadHasManyLocalKeys (mapper, def, records, __opts) {\n    const self = this\n    let record\n    const relatedMapper = def.getRelation()\n\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      record = records\n    }\n\n    if (record) {\n      return self.findAll(relatedMapper, {\n        where: {\n          [relatedMapper.idAttribute]: {\n            'in': self.makeHasManyLocalKeys(mapper, def, record)\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        def.setLocalField(record, relatedItems)\n      })\n    } else {\n      let localKeys = []\n      records.forEach(function (record) {\n        localKeys = localKeys.concat(self.self.makeHasManyLocalKeys(mapper, def, record))\n      })\n      return self.findAll(relatedMapper, {\n        where: {\n          [relatedMapper.idAttribute]: {\n            'in': unique(localKeys).filter(function (x) { return x })\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        records.forEach(function (item) {\n          let attached = []\n          let itemKeys = utils.get(item, def.localKeys) || []\n          itemKeys = utils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n          relatedItems.forEach(function (relatedItem) {\n            if (itemKeys && itemKeys.indexOf(relatedItem[relatedMapper.idAttribute]) !== -1) {\n              attached.push(relatedItem)\n            }\n          })\n          def.setLocalField(item, attached)\n        })\n        return relatedItems\n      })\n    }\n  },\n\n  loadHasManyForeignKeys (mapper, def, records, __opts) {\n    const self = this\n    const relatedMapper = def.getRelation()\n    const idAttribute = mapper.idAttribute\n    let record\n\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      record = records\n    }\n\n    if (record) {\n      return self.findAll(def.getRelation(), {\n        where: {\n          [def.foreignKeys]: {\n            'contains': self.makeHasManyForeignKeys(mapper, def, record)\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        def.setLocalField(record, relatedItems)\n      })\n    } else {\n      return self.findAll(relatedMapper, {\n        where: {\n          [def.foreignKeys]: {\n            'isectNotEmpty': records.map(function (record) {\n              return self.makeHasManyForeignKeys(mapper, def, record)\n            })\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        const foreignKeysField = def.foreignKeys\n        records.forEach(function (record) {\n          const _relatedItems = []\n          const id = utils.get(record, idAttribute)\n          relatedItems.forEach(function (relatedItem) {\n            const foreignKeys = utils.get(relatedItems, foreignKeysField) || []\n            if (foreignKeys.indexOf(id) !== -1) {\n              _relatedItems.push(relatedItem)\n            }\n          })\n          def.setLocalField(record, _relatedItems)\n        })\n      })\n    }\n  },\n\n  /**\n   * Load a hasOne relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#loadHasOne\n   * @method\n   * @return {Promise}\n   */\n  loadHasOne (mapper, def, records, __opts) {\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      records = [records]\n    }\n    return this.loadHasMany(mapper, def, records, __opts).then(function () {\n      records.forEach(function (record) {\n        const relatedData = def.getLocalField(record)\n        if (utils.isArray(relatedData) && relatedData.length) {\n          def.setLocalField(record, relatedData[0])\n        }\n      })\n    })\n  },\n\n  /**\n   * Return the foreignKey from the given record for the provided relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#makeBelongsToForeignKey\n   * @method\n   * @return {*}\n   */\n  makeBelongsToForeignKey (mapper, def, record) {\n    return def.getForeignKey(record)\n  },\n\n  /**\n   * Load a belongsTo relationship.\n   *\n   * Override with care.\n   *\n   * @name Adapter#loadBelongsTo\n   * @method\n   * @return {Promise}\n   */\n  loadBelongsTo (mapper, def, records, __opts) {\n    const self = this\n    const relationDef = def.getRelation()\n\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      const record = records\n      return self.find(relationDef, self.makeBelongsToForeignKey(mapper, def, record), __opts).then(function (relatedItem) {\n        def.setLocalField(record, relatedItem)\n      })\n    } else {\n      const keys = records.map(function (record) {\n        return self.makeBelongsToForeignKey(mapper, def, record)\n      }).filter(function (key) {\n        return key\n      })\n      return self.findAll(relationDef, {\n        where: {\n          [relationDef.idAttribute]: {\n            'in': keys\n          }\n        }\n      }, __opts).then(function (relatedItems) {\n        records.forEach(function (record) {\n          relatedItems.forEach(function (relatedItem) {\n            if (relatedItem[relationDef.idAttribute] === record[def.foreignKey]) {\n              def.setLocalField(record, relatedItem)\n            }\n          })\n        })\n      })\n    }\n  },\n\n  /**\n   * Retrieve the record with the given primary key. Called by `Mapper#find`.\n   *\n   * @name Adapter#find\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to retrieve.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  find (mapper, id, opts) {\n    const self = this\n    let record, op\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    // beforeFind lifecycle hook\n    op = opts.op = 'beforeFind'\n    return utils.resolve(self[op](mapper, id, opts)).then(function () {\n      op = opts.op = 'find'\n      self.dbg(op, mapper, id, opts)\n      return utils.resolve(self._find(mapper, id, opts))\n    }).then(function (results) {\n      let [_record] = results\n      if (!_record) {\n        return\n      }\n      record = _record\n      const tasks = []\n\n      utils.forEachRelation(mapper, opts, function (def, __opts) {\n        let task\n        if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n          if (def.type === 'hasOne') {\n            task = self.loadHasOne(mapper, def, record, __opts)\n          } else {\n            task = self.loadHasMany(mapper, def, record, __opts)\n          }\n        } else if (def.type === 'hasMany' && def.localKeys) {\n          task = self.loadHasManyLocalKeys(mapper, def, record, __opts)\n        } else if (def.type === 'hasMany' && def.foreignKeys) {\n          task = self.loadHasManyForeignKeys(mapper, def, record, __opts)\n        } else if (def.type === 'belongsTo') {\n          task = self.loadBelongsTo(mapper, def, record, __opts)\n        }\n        if (task) {\n          tasks.push(task)\n        }\n      })\n\n      return Promise.all(tasks)\n    }).then(function () {\n      let response = new Response(record, {}, 'find')\n      response.found = record ? 1 : 0\n      response = self.respond(response, opts)\n\n      // afterFind lifecycle hook\n      op = opts.op = 'afterFind'\n      return utils.resolve(self[op](mapper, id, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Retrieve the records that match the selection query.\n   *\n   * @name Adapter#findAll\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  findAll (mapper, query, opts) {\n    const self = this\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    let records = []\n    let op\n    const activeWith = opts._activeWith\n\n    if (utils.isObject(activeWith)) {\n      const activeQuery = activeWith.query || {}\n      if (activeWith.replace) {\n        query = activeQuery\n      } else {\n        utils.deepFillIn(query, activeQuery)\n      }\n    }\n\n    // beforeFindAll lifecycle hook\n    op = opts.op = 'beforeFindAll'\n    return utils.resolve(self[op](mapper, query, opts)).then(function () {\n      op = opts.op = 'findAll'\n      self.dbg(op, mapper, query, opts)\n      return utils.resolve(self._findAll(mapper, query, opts))\n    }).then(function (results) {\n      let [_records] = results\n      _records || (_records = [])\n      records = _records\n      const tasks = []\n      utils.forEachRelation(mapper, opts, function (def, __opts) {\n        let task\n        if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n          if (def.type === 'hasMany') {\n            task = self.loadHasMany(mapper, def, records, __opts)\n          } else {\n            task = self.loadHasOne(mapper, def, records, __opts)\n          }\n        } else if (def.type === 'hasMany' && def.localKeys) {\n          task = self.loadHasManyLocalKeys(mapper, def, records, __opts)\n        } else if (def.type === 'hasMany' && def.foreignKeys) {\n          task = self.loadHasManyForeignKeys(mapper, def, records, __opts)\n        } else if (def.type === 'belongsTo') {\n          task = self.loadBelongsTo(mapper, def, records, __opts)\n        }\n        if (task) {\n          tasks.push(task)\n        }\n      })\n      return Promise.all(tasks)\n    }).then(function () {\n      let response = new Response(records, {}, 'findAll')\n      response.found = records.length\n      response = self.respond(response, opts)\n\n      // afterFindAll lifecycle hook\n      op = opts.op = 'afterFindAll'\n      return utils.resolve(self[op](mapper, query, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Resolve the value of the specified option based on the given options and\n   * this adapter's settings. Override with care.\n   *\n   * @name Adapter#getOpt\n   * @method\n   * @param {string} opt The name of the option.\n   * @param {Object} [opts] Configuration options.\n   * @return {*} The value of the specified option.\n   */\n  getOpt (opt, opts) {\n    opts || (opts = {})\n    return utils.isUndefined(opts[opt]) ? utils.plainCopy(this[opt]) : utils.plainCopy(opts[opt])\n  },\n\n  /**\n   * Logging utility method. Override this method if you want to send log\n   * messages to something other than the console.\n   *\n   * @name Adapter#log\n   * @method\n   * @param {string} level Log level.\n   * @param {...*} values Values to log.\n   */\n  log (level, ...args) {\n    if (level && !args.length) {\n      args.push(level)\n      level = 'debug'\n    }\n    if (level === 'debug' && !this.debug) {\n      return\n    }\n    const prefix = `${level.toUpperCase()}: (Adapter)`\n    if (console[level]) {\n      console[level](prefix, ...args)\n    } else {\n      console.log(prefix, ...args)\n    }\n  },\n\n  /**\n   * Retrieve sum of the specified field of the records that match the selection\n   * query. Called by `Mapper#sum`.\n   *\n   * @name Adapter#sum\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {string} field By to sum.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  sum (mapper, field, query, opts) {\n    const self = this\n    let op\n    if (!utils.isString(field)) {\n      throw new Error('field must be a string!')\n    }\n    query || (query = {})\n    opts || (opts = {})\n\n    // beforeSum lifecycle hook\n    op = opts.op = 'beforeSum'\n    return utils.resolve(self[op](mapper, field, query, opts)).then(function () {\n      // Allow for re-assignment from lifecycle hook\n      op = opts.op = 'sum'\n      self.dbg(op, mapper, field, query, opts)\n      return utils.resolve(self._sum(mapper, field, query, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, op)\n      response = self.respond(response, opts)\n\n      // afterSum lifecycle hook\n      op = opts.op = 'afterSum'\n      return utils.resolve(self[op](mapper, field, query, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * @name Adapter#respond\n   * @method\n   * @param {Object} response Response object.\n   * @param {Object} opts Configuration options.\n   * return {Object} If `opts.raw == true` then return `response`, else return\n   * `response.data`.\n   */\n  respond (response, opts) {\n    return this.getOpt('raw', opts) ? response : response.data\n  },\n\n  /**\n   * Apply the given update to the record with the specified primary key. Called\n   * by `Mapper#update`.\n   *\n   * @name Adapter#update\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {(string|number)} id The primary key of the record to be updated.\n   * @param {Object} props The update to apply to the record.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  update (mapper, id, props, opts) {\n    const self = this\n    props || (props = {})\n    opts || (opts = {})\n    let op\n\n    // beforeUpdate lifecycle hook\n    op = opts.op = 'beforeUpdate'\n    return utils.resolve(self[op](mapper, id, props, opts)).then(function (_props) {\n      // Allow for re-assignment from lifecycle hook\n      props = utils.isUndefined(_props) ? props : _props\n      op = opts.op = 'update'\n      self.dbg(op, mapper, id, props, opts)\n      return utils.resolve(self._update(mapper, id, props, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      result || (result = {})\n      let response = new Response(data, result, 'update')\n      response.updated = data ? 1 : 0\n      response = self.respond(response, opts)\n\n      // afterUpdate lifecycle hook\n      op = opts.op = 'afterUpdate'\n      return utils.resolve(self[op](mapper, id, props, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Apply the given update to all records that match the selection query.\n   * Called by `Mapper#updateAll`.\n   *\n   * @name Adapter#updateAll\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object} props The update to apply to the selected records.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  updateAll (mapper, props, query, opts) {\n    const self = this\n    props || (props = {})\n    query || (query = {})\n    opts || (opts = {})\n    let op\n\n    // beforeUpdateAll lifecycle hook\n    op = opts.op = 'beforeUpdateAll'\n    return utils.resolve(self[op](mapper, props, query, opts)).then(function (_props) {\n      // Allow for re-assignment from lifecycle hook\n      props = utils.isUndefined(_props) ? props : _props\n      op = opts.op = 'updateAll'\n      self.dbg(op, mapper, props, query, opts)\n      return utils.resolve(self._updateAll(mapper, props, query, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      data || (data = [])\n      result || (result = {})\n      let response = new Response(data, result, 'updateAll')\n      response.updated = data.length\n      response = self.respond(response, opts)\n\n      // afterUpdateAll lifecycle hook\n      op = opts.op = 'afterUpdateAll'\n      return utils.resolve(self[op](mapper, props, query, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  },\n\n  /**\n   * Update the given records in a single batch. Called by `Mapper#updateMany`.\n   *\n   * @name Adapter#updateMany\n   * @method\n   * @param {Object} mapper The mapper.\n   * @param {Object[]} records The records to update.\n   * @param {Object} [opts] Configuration options.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @return {Promise}\n   */\n  updateMany (mapper, records, opts) {\n    const self = this\n    records || (records = [])\n    opts || (opts = {})\n    let op\n    const idAttribute = mapper.idAttribute\n\n    records = records.filter(function (record) {\n      return utils.get(record, idAttribute)\n    })\n\n    // beforeUpdateMany lifecycle hook\n    op = opts.op = 'beforeUpdateMany'\n    return utils.resolve(self[op](mapper, records, opts)).then(function (_records) {\n      // Allow for re-assignment from lifecycle hook\n      records = utils.isUndefined(_records) ? records : _records\n      records = records.map(function (record) {\n        return withoutRelations(mapper, record)\n      })\n      op = opts.op = 'updateMany'\n      self.dbg(op, mapper, records, opts)\n      return utils.resolve(self._updateMany(mapper, records, opts))\n    }).then(function (results) {\n      let [data, result] = results\n      data || (data = [])\n      result || (result = {})\n      let response = new Response(data, result, 'updateMany')\n      response.updated = data.length\n      response = self.respond(response, opts)\n\n      // afterUpdateMany lifecycle hook\n      op = opts.op = 'afterUpdateMany'\n      return utils.resolve(self[op](mapper, records, opts, response)).then(function (_response) {\n        // Allow for re-assignment from lifecycle hook\n        return utils.isUndefined(_response) ? response : _response\n      })\n    })\n  }\n})\n\nmodule.exports = Adapter\n"],"names":["utils"],"mappings":"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"}